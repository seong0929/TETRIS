<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ScoreBoardPanelTab.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tetris</a> &gt; <a href="index.source.html" class="el_package">org.teamseven.tetris.ui</a> &gt; <span class="el_source">ScoreBoardPanelTab.java</span></div><h1>ScoreBoardPanelTab.java</h1><pre class="source lang-java linenums">package org.teamseven.tetris.ui;

import org.teamseven.tetris.Pipeline;
import org.teamseven.tetris.handler.PreferencesHandler;
import org.teamseven.tetris.handler.ScoreMemoryHandler;
import org.teamseven.tetris.score.Score;

import javax.swing.*;
import javax.swing.border.Border;
import java.awt.*;
import java.util.List;

import static javax.swing.JOptionPane.showInputDialog;
import static org.teamseven.tetris.Const.SCORE_ITEM_FILE;
import static org.teamseven.tetris.Const.SCORE_NORMAL_FILE;

public class ScoreBoardPanelTab extends JPanel implements  IDesign {

    private int[] preferredResolution;  // frame resolution - frame top border
    private JLabel title;

    private JPanel titlePanel, buttonPanel;
    private JPanel scorePanel1st, scorePanel2st, scorePanel3st, scorePanel4st, scorePanel5st,
            scorePanel6st, scorePanel7st, scorePanel8st, scorePanel9st, scorePanel10st;
    private  JPanel[] scorePanels;
    private JPanel line1st, line2st, line3st, line4st, line5st, line6st, line7st, line8st, line9st, line10st;

    private CustomButton homeBtn;

<span class="nc" id="L30">    private int pageNum = 0;</span>
<span class="nc" id="L31">    private int totalPageNum = 0;</span>
    private GridBagConstraints gridBagConstraints;
    private GridBagLayout gridBagLayout;
<span class="nc" id="L34">    private ScoreMemoryHandler handler = new ScoreMemoryHandler();</span>
    private String fileName;
<span class="nc" id="L36">    private String highlightUUID = null;</span>
    List&lt;Score&gt; scores;

<span class="nc" id="L39">    public ScoreBoardPanelTab(int[] preferredResolution, boolean itemMode, int newScore) {</span>
<span class="nc" id="L40">        this.preferredResolution = preferredResolution;</span>

<span class="nc bnc" id="L42" title="All 2 branches missed.">        fileName = itemMode ? SCORE_ITEM_FILE : SCORE_NORMAL_FILE;</span>
<span class="nc" id="L43">        scores = handler.getScores(fileName);</span>

<span class="nc" id="L45">        setComp();</span>
<span class="nc" id="L46">        setDesign();</span>
<span class="nc" id="L47">        setAction();</span>

<span class="nc bnc" id="L49" title="All 6 branches missed.">        if(newScore &gt;= 0 &amp;&amp; (scores.size() &lt; 10 || newScore &gt; scores.stream().map(Score::getScore).map(Integer::valueOf).mapToInt(k -&gt; k).min().getAsInt())) {</span>
<span class="nc" id="L50">            this.revalidate();</span>
<span class="nc" id="L51">            this.repaint();</span>
<span class="nc" id="L52">            String name = showInputDialog(&quot;이름을 입력하세요.&quot;);</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">            Score score = new Score(newScore, name, itemMode ? &quot;ITEM&quot; : PreferencesHandler.getMode().name());</span>
<span class="nc" id="L54">            highlightUUID = score.getUuid();</span>
<span class="nc" id="L55">            addScore(score);</span>

<span class="nc" id="L57">            scores = handler.getScores(fileName);</span>
<span class="nc" id="L58">            clear();</span>
<span class="nc" id="L59">            draw(pageNum);</span>
        }
<span class="nc" id="L61">    }</span>

    @Override
    public void setComp() {
<span class="nc" id="L65">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L66">        gridBagLayout = new GridBagLayout();</span>

<span class="nc" id="L68">        titlePanel = new JPanel();</span>
<span class="nc" id="L69">        scorePanel1st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L70">        scorePanel2st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L71">        scorePanel3st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L72">        scorePanel4st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L73">        scorePanel5st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L74">        scorePanel6st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L75">        scorePanel7st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L76">        scorePanel8st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L77">        scorePanel9st = new JPanel(new GridLayout(0,5,0,0));</span>
<span class="nc" id="L78">        scorePanel10st = new JPanel(new GridLayout(0,5,0,0));</span>

<span class="nc" id="L80">        scorePanels = new JPanel[]{scorePanel1st, scorePanel2st, scorePanel3st, scorePanel4st, scorePanel5st,</span>
                scorePanel6st, scorePanel7st, scorePanel8st, scorePanel9st, scorePanel10st};

<span class="nc" id="L83">        line1st = new JPanel();</span>
<span class="nc" id="L84">        line2st = new JPanel();</span>
<span class="nc" id="L85">        line3st = new JPanel();</span>
<span class="nc" id="L86">        line4st = new JPanel();</span>
<span class="nc" id="L87">        line5st = new JPanel();</span>
<span class="nc" id="L88">        line6st = new JPanel();</span>
<span class="nc" id="L89">        line7st = new JPanel();</span>
<span class="nc" id="L90">        line8st = new JPanel();</span>
<span class="nc" id="L91">        line9st = new JPanel();</span>
<span class="nc" id="L92">        line10st = new JPanel();</span>

<span class="nc" id="L94">        buttonPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 130, 0));</span>

<span class="nc" id="L96">        title = new JLabel(&quot;SCORE&quot;);</span>

<span class="nc" id="L98">        homeBtn = new CustomButton();</span>
<span class="nc" id="L99">    }</span>

    @Override
    public void setDesign() {
<span class="nc" id="L103">        this.setLayout(gridBagLayout);</span>
<span class="nc" id="L104">        this.setBackground(Color.white);</span>

<span class="nc" id="L106">        gridBagConstraints.fill = GridBagConstraints.BOTH;</span>

<span class="nc" id="L108">        titlePanel.add(title);</span>
<span class="nc" id="L109">        titlePanel.setPreferredSize(new Dimension(preferredResolution[1] * 8 / 130,preferredResolution[1] * 8 / 130));</span>
<span class="nc" id="L110">        title.setFont(new Font(&quot;ss&quot;,Font.CENTER_BASELINE,preferredResolution[1] * 10 / 130));</span>
<span class="nc" id="L111">        title.setForeground(Color.orange);</span>

<span class="nc" id="L113">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L114">        gridBagConstraints.weighty = 4.0;</span>

<span class="nc" id="L116">        gridBagConstraints.insets = new Insets(preferredResolution[1] * 4 / 130, 0, 0, 0);</span>
<span class="nc" id="L117">        make(this, titlePanel,1,0,1,1);</span>
<span class="nc" id="L118">        gridBagConstraints.weighty = 2.0;</span>
<span class="nc" id="L119">        gridBagConstraints.insets = new Insets(preferredResolution[1] * 4 / 130, preferredResolution[0] / 6, 0, preferredResolution[0] / 8);</span>

<span class="nc" id="L121">        make(this, scorePanel1st,1,1,1,1);</span>

<span class="nc" id="L123">        gridBagConstraints.insets = new Insets(0, preferredResolution[0] / 6, 0, preferredResolution[0] / 8);</span>
<span class="nc" id="L124">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L125">        make(this, line1st,1,2,1,1);</span>
<span class="nc" id="L126">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L128">        make(this, scorePanel2st,1,3,1,1);</span>

<span class="nc" id="L130">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L131">        make(this, line2st,1,4,1,1);</span>
<span class="nc" id="L132">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L134">        make(this, scorePanel3st,1,5,1,1);</span>

<span class="nc" id="L136">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L137">        make(this, line3st,1,6,1,1);</span>
<span class="nc" id="L138">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L140">        make(this, scorePanel4st,1,7,1,1);</span>

<span class="nc" id="L142">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L143">        make(this, line4st,1,8,1,1);</span>
<span class="nc" id="L144">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L146">        make(this, scorePanel5st,1,9,1,1);</span>

<span class="nc" id="L148">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L149">        make(this, line5st,1,10,1,1);</span>
<span class="nc" id="L150">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L152">        make(this, scorePanel6st,1,11,1,1);</span>

<span class="nc" id="L154">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L155">        make(this, line6st,1,12,1,1);</span>
<span class="nc" id="L156">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L158">        make(this, scorePanel7st,1,13,1,1);</span>

<span class="nc" id="L160">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L161">        make(this, line7st,1,14,1,1);</span>
<span class="nc" id="L162">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L164">        make(this, scorePanel8st,1,15,1,1);</span>

<span class="nc" id="L166">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L167">        make(this, line8st,1,16,1,1);</span>
<span class="nc" id="L168">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L170">        make(this, scorePanel9st,1,17,1,1);</span>

<span class="nc" id="L172">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L173">        make(this, line9st,1,18,1,1);</span>
<span class="nc" id="L174">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L176">        make(this, scorePanel10st,1,19,1,1);</span>

<span class="nc" id="L178">        gridBagConstraints.weighty = 0.1;</span>
<span class="nc" id="L179">        make(this, line10st,1,20,1,1);</span>
<span class="nc" id="L180">        gridBagConstraints.weighty = 2.0;</span>

<span class="nc" id="L182">        gridBagConstraints.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L183">        make(this, buttonPanel,1,21,1,1);</span>

<span class="nc" id="L185">        homeBtn.setFont(new Font(&quot;ss&quot;,Font.BOLD,preferredResolution[1] * 8 / 130));</span>
<span class="nc" id="L186">        homeBtn.setForeground(Color.gray);</span>


<span class="nc" id="L189">        homeBtn.setText(&quot;홈&quot;);</span>
<span class="nc" id="L190">        buttonPanel.add(homeBtn);</span>
<span class="nc" id="L191">    }</span>

    @Override
    public void setAction() {
<span class="nc" id="L195">        draw(pageNum);</span>

<span class="nc" id="L197">        homeBtn.addActionListener(e -&gt; {</span>
<span class="nc" id="L198">            Pipeline.replacePane(new GameMenuPane());</span>
<span class="nc" id="L199">        });</span>
<span class="nc" id="L200">    }</span>

    public void make(JPanel p, JComponent c, int x, int y, int w, int h) {
<span class="nc" id="L203">        gridBagConstraints.gridx = x;</span>
<span class="nc" id="L204">        gridBagConstraints.gridy = y;</span>
<span class="nc" id="L205">        gridBagConstraints.gridwidth = w;</span>
<span class="nc" id="L206">        gridBagConstraints.gridheight = h;</span>
<span class="nc" id="L207">        p.add(c, gridBagConstraints);</span>

        // for test
<span class="nc" id="L210">        c.setBackground(Color.white);</span>
        // c.setBackground(Color.getHSBColor((y+1)  /9f + (x+1) /9f,0.75f,0.95f));
        //  gridBagConstraints.insets = new Insets(15,10,15,10);

<span class="nc" id="L214">    }</span>

    public  void draw(int pageNum){
<span class="nc" id="L217">        totalPageNum = scores.size() / 10;</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">        for(int i = 0; i&lt;10; i++){</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">            if(scores.size() == pageNum*10 + i){break;};</span>
<span class="nc" id="L220">            JLabel tempLabel = new JLabel();</span>
<span class="nc" id="L221">            tempLabel.setFont(new Font(&quot;ss&quot;,Font.BOLD,preferredResolution[1] * 4 / 130));</span>
<span class="nc" id="L222">            tempLabel.setForeground(Color.gray);</span>
<span class="nc" id="L223">            tempLabel.setText(String.valueOf(pageNum*10+i+1));</span>
<span class="nc" id="L224">            scorePanels[i].add(tempLabel);</span>

<span class="nc" id="L226">            Score score = scores.get(pageNum*10+i);</span>

<span class="nc" id="L228">            JLabel tempLabel2 = new JLabel();</span>
<span class="nc" id="L229">            tempLabel2.setFont(new Font(&quot;ss&quot;,Font.BOLD,preferredResolution[1] * 4 / 130));</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">            if(score.getUuid().equals(highlightUUID))</span>
<span class="nc" id="L231">                tempLabel2.setForeground(Color.YELLOW);</span>
            else
<span class="nc" id="L233">                tempLabel2.setForeground(Color.gray);</span>
<span class="nc" id="L234">            tempLabel2.setText(score.getName());</span>
<span class="nc" id="L235">            scorePanels[i].add(tempLabel2);</span>

<span class="nc" id="L237">            JLabel tempLabel3 = new JLabel();</span>
<span class="nc" id="L238">            tempLabel3.setFont(new Font(&quot;ss&quot;,Font.BOLD,preferredResolution[1] * 4 / 130));</span>
<span class="nc" id="L239">            tempLabel3.setForeground(Color.gray);</span>
<span class="nc" id="L240">            tempLabel3.setText(score.getScore());</span>
<span class="nc" id="L241">            scorePanels[i].add(tempLabel3);</span>

<span class="nc" id="L243">            JLabel tempLabel4 = new JLabel();</span>
<span class="nc" id="L244">            tempLabel4.setFont(new Font(&quot;ss&quot;,Font.BOLD,preferredResolution[1] * 4 / 130));</span>
<span class="nc" id="L245">            tempLabel4.setForeground(Color.gray);</span>
<span class="nc" id="L246">            tempLabel4.setText(score.getDate().substring(5));</span>
<span class="nc" id="L247">            tempLabel4.setHorizontalAlignment(JLabel.RIGHT);</span>
<span class="nc" id="L248">            scorePanels[i].add(tempLabel4);</span>

<span class="nc" id="L250">            JLabel tempLabel5 = new JLabel();</span>
<span class="nc" id="L251">            tempLabel5.setFont(new Font(&quot;ss&quot;,Font.BOLD,preferredResolution[1] * 4 / 130));</span>
<span class="nc" id="L252">            tempLabel5.setForeground(Color.gray);</span>
<span class="nc" id="L253">            tempLabel5.setText(score.getMode());</span>
<span class="nc" id="L254">            tempLabel5.setHorizontalAlignment(JLabel.RIGHT);</span>
<span class="nc" id="L255">            scorePanels[i].add(tempLabel5);</span>

<span class="nc" id="L257">            scorePanels[i].setPreferredSize(new Dimension(preferredResolution[1] * 8 / 130,preferredResolution[1] * 3 / 130));</span>
<span class="nc" id="L258">            this.revalidate();</span>
<span class="nc" id="L259">            this.repaint();</span>
        }
<span class="nc" id="L261">    }</span>

    public  void clear(){
<span class="nc bnc" id="L264" title="All 2 branches missed.">        for(int i = 0; i&lt;10; i++) {</span>
<span class="nc" id="L265">            scorePanels[i].removeAll();</span>
<span class="nc" id="L266">            scorePanels[i].setBorder(null);</span>
        }


<span class="nc" id="L270">    }</span>
    public void addScore( Score score){
<span class="nc" id="L272">        List&lt;Score&gt; scores = handler.getScores(this.fileName);</span>
<span class="nc" id="L273">        int index=0;</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">        for(Score s : scores)</span>
        {
<span class="nc bnc" id="L276" title="All 2 branches missed.">            if(score.compareTo(s) == -1){break;}</span>

<span class="nc" id="L278">            index++;</span>
<span class="nc" id="L279">            System.out.println(index);</span>

<span class="nc" id="L281">        }</span>
<span class="nc" id="L282">        int tempPageNum = index / 10;</span>
<span class="nc" id="L283">        index = index - tempPageNum*10;</span>
<span class="nc" id="L284">        System.out.println(index);</span>

<span class="nc" id="L286">        handler.saveScoreFile(score, this.fileName);</span>

<span class="nc" id="L288">        clear();</span>
<span class="nc" id="L289">        Border border = BorderFactory.createLineBorder(Color.orange, 3);</span>
<span class="nc" id="L290">        scorePanels[index].setBorder(border);</span>
<span class="nc" id="L291">        draw(tempPageNum);</span>
<span class="nc" id="L292">        pageNum = tempPageNum;</span>
<span class="nc" id="L293">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>